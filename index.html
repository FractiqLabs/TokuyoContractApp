<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>特養入居契約デジタル化システム</title>
    <link rel="stylesheet" href="style.css">
    
    <!-- Three.js and VRM Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.157.0/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@pixiv/three-vrm@1.0.9/lib/three-vrm.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.157.0/examples/js/loaders/GLTFLoader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.157.0/examples/js/controls/OrbitControls.js"></script>
</head>
<body>
    <div id="app-container">
        <header>
            <h1>特養入居契約デジタルシステム</h1>
            <div id="progress-container">
                <div id="progress-bar"></div>
                <span id="progress-label">1 / 10</span>
            </div>
        </header>
        <main>
            <div id="video-container">
                <div id="character-area">
                    <!-- VRoid 3D Character Display -->
                    <div id="vroid-container">
                        <canvas id="vroid-canvas"></canvas>
                    </div>
                    <!-- Fallback 2D Character -->
                    <img src="assets/images/character.svg" alt="VTuberキャラクター" id="character-image" style="display: none;">
                    
                    <div id="character-info">
                        <p id="character-name">説明担当：双葉</p>
                        <div id="character-controls">
                            <button id="upload-vroid-btn" class="control-btn-mini">📁 VRoidアップロード</button>
                            <button id="upload-voice-btn" class="control-btn-mini">🎤 音声アップロード</button>
                            <button id="faq-btn" class="faq-btn-mini">❓ FAQ</button>
                        </div>
                        <div id="faq-chat-container" class="hidden">
                            <div id="faq-messages-sidebar"></div>
                            <div id="faq-buttons-sidebar"></div>
                        </div>
                    </div>
                    
                    <!-- Hidden file inputs -->
                    <input type="file" id="vroid-file-input" accept=".vrm" style="display: none;">
                    <input type="file" id="voice-file-input" accept=".wav,.mp3" multiple style="display: none;">
                    
                    <!-- Audio element for VOICEVOX playback -->
                    <audio id="voicevox-audio" style="display: none;"></audio>
                </div>
                <div id="subtitle-area">
                    <div id="subtitle-content">
                        <div id="subtitle-title"></div>
                        <div id="subtitle-text"></div>
                    </div>
                </div>
                <div id="video-controls">
                    <div id="progress-bar-video"></div>
                    <div id="control-buttons">
                        <button id="prev-btn" class="video-btn">⏮</button>
                        <button id="play-pause-btn" class="video-btn play-btn">▶</button>
                        <button id="next-btn" class="video-btn">⏭</button>
                        <button id="complete-btn" class="video-btn complete-btn" style="display: none;">✓</button>
                        <div id="speed-controls-video">
                            <input type="range" id="speed-range" min="0.5" max="2.5" step="0.1" value="1.0">
                            <span id="speed-label">1.0x</span>
                        </div>
                    </div>
                </div>
            </div>
            <div id="sidebar">
                <div class="sidebar-section">
                    <div class="sidebar-header" data-section="contract">
                        <span class="tree-icon">▶</span>
                        <span class="tree-title">入居契約書</span>
                    </div>
                    <div class="sidebar-content" id="contract-sections"></div>
                </div>
                <div class="sidebar-section">
                    <div class="sidebar-header" data-section="important">
                        <span class="tree-icon">▶</span>
                        <span class="tree-title">重要事項説明書</span>
                    </div>
                    <div class="sidebar-content" id="important-sections"></div>
                </div>
                <div class="sidebar-section">
                    <div class="sidebar-header" data-section="consent">
                        <span class="tree-icon">▶</span>
                        <span class="tree-title">同意書</span>
                    </div>
                    <div class="sidebar-content" id="consent-sections"></div>
                </div>
                <div class="sidebar-section">
                    <div class="sidebar-header" data-section="admission">
                        <span class="tree-icon">▶</span>
                        <span class="tree-title">入居に関する同意書</span>
                    </div>
                    <div class="sidebar-content" id="admission-sections"></div>
                </div>
                <div class="sidebar-section">
                    <div class="sidebar-header" data-section="pricing">
                        <span class="tree-icon">▶</span>
                        <span class="tree-title">料金表</span>
                    </div>
                    <div class="sidebar-content" id="pricing-sections"></div>
                </div>
            </div>
        </main>
    </div>

    <div id="completion-modal" class="hidden">
        <div id="completion-content">
            <h2>🎉 説明完了</h2>
            <p>重要事項説明書の説明が完了しました。</p>
            <p>ご不明な点がございましたら、いつでもお声かけください。</p>
            <p><strong>次のステップ：</strong>契約書へのご署名をお願いいたします。</p>
            <button id="close-completion-btn">閉じる</button>
        </div>
    </div>

    <div id="faq-modal" class="hidden">
        <div id="faq-content">
            <div id="faq-header">
                <h2>❓ よくある質問</h2>
                <button id="close-faq-btn">×</button>
            </div>
            <div id="faq-messages"></div>
            <div id="faq-input-area">
                <div id="faq-buttons"></div>
            </div>
        </div>
    </div>

    <script src="./src/vroid-integration.js"></script>
    <script src="./src/script.js"></script>
</body>
</html>
